转义
=====================

#### 背景：

没对 `<script>` 等转义，遭遇 XSS 攻击。

#### 解决：

- `lodash` 中用 `<%-` , 而非 `<%= `
- `jquery` 中用 `.text()` 而非 `.html()`;

除了在展示时做处理外，也可在保存时处理。注意不要重复转义。

#### 转码和转义

要看在什么语境下。

前端提及"转义"，往往指的是 html 转义字符串，即针对像 `<` 和 `>` 这类已用来表示HTML标签的符号，就不能直接当做文本中的符号来使用。比如 `<` 就应该转义成 `&lt;`

而有时候提“转义”，其实是指转码。比如url上的中文参数转成 Unicode编码 。

#### HTML 转义符

`&lt;`, `&gt;`, `&amp;`, `&quot;`, `&copy;`。 分别是`<`，`>`，`&`，`"`，`©`的转义字符；

#### 手动转义：

	function encodeHTML(a) {
	    return String(a)
	        .replace(/&/g, "&amp;")
	        .replace(/</g, "&lt;")
	        .replace(/>/g, "&gt;")
	        .replace(/"/g, "&quot;")
	        .replace(/'/g, "&#39;");
	}

#### ASCII 和 Unicode

1. `Unicode` 为每种语言中的每个字符设定了统一并且唯一的二进制编码，以满足跨语言、跨平台进行文本转换、处理的要求。

	- U+003C < Less-than sign
	- U+003E > Greater-than sign

2. `ASCII` 是基于拉丁字母的一套电脑编码系统，主要用于显示现代英语和其他西欧语言。


#### escape() 函数

1. escape() 函数可对字符串进行编码，这样就可以在所有的计算机上读取该字符串。
2. 该方法不会对 ASCII 字母和数字进行编码，也不会对下面这些 ASCII 标点符号进行编码： * @ - _ + . / 。其他所有的字符都会被转义序列替换。

#### 关于 JSON

- 前端 `JSON.stringify()` 把 JavaScript 值转成 JSON 字符串；如：'[1,"false",false]'
- 后端做 JSON序列化时候，会把字符转成 `Unicode` 编码格式；如 `<` 转成 `\u003c`


#### url 转义

- `&` 字符。如参数 `name==“P&G”` ,传参不转义的话，变成 `xxx?name=P&G&name2=lily`; 故要将参数的 `&` 转成16进制, 以与连接符的 `&` 区分;
- 中文等其他非标准化字符

两个方法：

- 使用 `encodeURI()` 方法去做url 转义； （不对url特舒符转义：`:`, `/`, `?`, `&`, `=`）
- 使用 `URIComponent()` 方法去对url 的参数转义；






