---
layout: post
title: 性能优化之图片篇
date: 2014-08-04
categories: Note
tag: "学习总结、体会"
desc: "PNG 和 JPG 格式的区别是什么？无损压缩是否就是完全不失真的压缩？雪碧图有何缺点？应选用那种图标形式？图片预加载和懒加载的应用场景是什么？"
imgUrl: "data/post_thumb/image.png"
trueDate: '20150706'
---


# 选择合适的图片格式

1. PNG 

	PNG 属于无损压缩。无损压缩并不是绝对不损品质的压缩，它对图片的复原是基于储存的颜色索引表。当颜色索引表中的颜色数量小于图片的真实数量（如 png8 只能索引256种颜色）时，图片便会失真。所以 png 适合用于色彩相对规律的图片，如图标、数码绘等；另外 PNG 支持透明度，需要有透明效果的图片可选用 PNG 格式。

	当今设计潮流趋于平面化、轻量化、清爽型设计，大部分网页素材图片都是 PNG 格式。

2. JPG 

	JPG 属于有损压缩，根据人眼特性对图像进行适当降质处理。适合用于色彩错综复杂的图片，如摄影照片、用了很多光影滤镜的图、加了真实素材的图片等；

	需要注意的是，对色彩简单的图片，使用 JPG 反而还有可能增添无谓的噪点。

3. GIF 

	用于动态图；


# 使用雪碧图

- 把图标们拼在一张图上，利用css对其进行定位。非常常用的一种方法，好处就是大大减少请求量。
- 缺点
	1. 浏览器缩放的时候边缘会露出其他图标；
	2. 有些图标不是常用图标，但也一起加载了进来；
	3. sprite图越来越大时，PNG 压缩有失真;

<i class="fa fa-comment"></i> 也说说图标

使用雪碧图来集合众多图标是非常常见的一种方法，但不是那么灵活方便。而字体图标（Icon font）就更酷炫一点，可以自由伸缩、像css一样改变颜色大小等，自由度大大提高。但是这样的字体库非常大，无疑拖慢了网页访问速度。相比之下 SVG icon 的可控性就更强了，最起码不用加载一个如此硕大的字体库。虽然有浏览器兼容性问题，不过也值得用一用。

- 一款之前我常用的字体图标库 －[Font Awesome ](http://fortawesome.github.io/Font-Awesome/) 
- 准备稍后研究研究的 SVG icon - [iconfont](http://www.iconfont.cn/)

# 图片预加载和懒加载

1. 什么情况使用预加载，什么情况使用懒加载？
	- 懒加载：

		应用于图片众多的场景，特别是多屏图片，如流图片展示，像花瓣网那种格式；按需加载，提高首屏展示速度。
	
	- 预加载：

		顾名思义，就是让图片预先加载到浏览器缓存中，如图片幻灯片，阅读漫画等。要预测用户行为，不能等点击下一张才开始加载图片；

2. 预加载的两种方式：
	1. CSS 

		其实就是利用 background 属性。只要这些图片的路径保持不变，当它们在Web页面的其他地方被调用时，浏览器就会在渲染过程中使用缓存。

		缺点：延长了 CSS 文件的下载时间。

	2. JS 
		
		在页面加载完后，`window.onload` 后，通过 `new Image()`，并把图片赋值给 src 属性。回调时注意`complete`和`onload`属性。图片初次下载完成后会触发`onload`事件，而若已存在缓存中，就要通过判断`complete`去获取状态。

3. 懒加载的两种方式：
	1. 纯粹的延迟加载，使用 `setTimeOut` 或 `setInterval` 进行加载延迟.
	2. 事件触发性加载，如click时才开始异步下载；或者监控滚动条，保证可视区的加载。


一个懒加载插件： [jquery-lazyload](http://www.appelsiini.net/projects/lazyload)


# 其他提高用户体验的图片优化方案

- 先快速加载小图，虽比较模糊，等大图下载完了替换小图，图像变清晰。这样就不会让用户感到在白等图片下载。
- (待补充...)


# 参考文章

- [淘宝开放平台-前端性能优化](https://open.taobao.com/doc/detail.htm?id=101942)
- [Lazy Load Plugin for jQuery](http://www.appelsiini.net/projects/lazyload)
- [Javascript图片预加载详解](http://www.cnblogs.com/v10258/p/3376455.html)
- [Taobao UED -图片格式与设计那点事儿](http://ued.taobao.org/blog/2010/12/jpg_png/)
