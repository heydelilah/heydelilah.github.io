---
layout: post
title:  "前端单元测试"
date:   2014-08-04 21:54:00
categories: Note
---

近期被安排去调研前端Unit testing情况。从一无所知到有了个大致了解，自我总结一下。

经过一系列比较，选择了`Mocha`测试框架，`chai`和`sinon`作为附加库；

前端单元测试可分浏览器端和服务端。部署是比较简单的，浏览器端基本上就是一个html引入各种所需测试框架文件与测试用例，然后mocha.run即可；服务端也是全局`npm install mocha`后，直接与bash端执行mocha命令即可。

不过一开始由于我并没有意识到有Browser和Server之分，而使用server那一套的部署方式捣鼓了很久，绕了很多圈子。Server端是没有document,windows等BOM对象的，所以根本是无法直接跑（后来发现了`jsdom`等，可在服务端模拟DOM，不过这是后话了），这是报错的原因，而我一直认为纠结于如何把浏览器端的seajs改为node端的seajs上。

Unit testing是好东西，它能解决我们此刻面临的重大问题：开发效率。这半年来，深刻体会到平日工作内容最多最烦心的不是逻辑开发，而是debug.需求每天都在新增，项目在臃肿，经手的程序员也越来越多；一处无关痛痒的改动，往往会牵动另一处的代码，于是就陷入了无穷无尽的debug深渊中。
当然，添加Unit test不是绝对的解决之法，最大限度的减少不必要的bug要各方面都一起加强：比如项目规范，逻辑开发时候考虑扩展性等等。

当明确了要添加unit test后，就剩下测试用例要怎么写的问题了。理论上说这应该不是一个问题，但事实上这是最大的问题。

1. 测交互；各种操作的组合情况 -需要模拟每种情况，而组合很多
2. 测DOM； 界面构建是否到达预期；-使用jq获取界面已创建好的元素，一一对比，十分繁琐；
3. 测数据；-相对好测一点。

所以如果真的使用TDD（测试驱动）的模式去开发，虽然维护效率会大大提升，但开发时间恐怕会增加一倍以上呢。
择取一些重点部分写测试用例吧，继续研究~

如果真的能以TDD的方式去开发就真挺好的，因为现项目面临的问题之一是耦合太重的问题。而写测试用例的过程是强迫自己解耦模块的过程，因为太耦合的代码写起测试用例来只会吐血。

还有很多TODO要完成。比如
1. 自动化测试，看看是不是能与`grunt`结合起来；
2. 调研一下无头测试- `phantomjs` ；
3. 添加代码覆盖率报告；使用`mockJS`模拟测试数据。
